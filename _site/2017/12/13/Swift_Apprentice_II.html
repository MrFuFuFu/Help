<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.">
    <meta name="keywords"  content="">
    <meta name="theme-color" content="">

    <title>Swift Apprentice II -- Advanced Topics - </title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.ico">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="http://localhost:4000/2017/12/13/Swift_Apprentice_II.html">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Your awesome title</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <!-- <li>
                        <a href="/">Home</a>
                    </li>
                    
                    <li>
                        <a href="/about.html">About</a>
                    </li>
                    
                    <li>
                        <a href="/learn.html">Learn</a>
                    </li>
                    
                    <li>
                        <a href="/tags.html">Tags</a>
                    </li>
                     -->

                    <li>
                    <a href="/">Home</a>
                    </li>
                    <!--
                    <li>
                        <a href="/about.html">About</a>
                    </li>
                    
                    <li>
                        <a href="/learn.html">Learn</a>
                    </li>
                    
                    <li>
                        <a href="/tags.html">Tags</a>
                    </li>
                    -->
                    
                    <!--<li>
                        <a href="/learn/">Learn</a>
                    </li>-->
                    
                    <li>
                        <a href="/tags/">Tags</a>
                    </li>
                    
                    <li>
                        <a href="/about/">About</a>
                    </li>

                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Image to hack wechat -->
<!-- <img src="/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="/img/post-bg-swift-apprentice.png" width="0" height="0"> -->

<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        background-image: url('/img/post-bg-swift-apprentice.png')
    }

    
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/#Swift" title="Swift">Swift</a>
                        
                    </div>
                    <h1>Swift Apprentice II -- Advanced Topics</h1>
                    
                    
                    <h2 class="subheading">Swift notes</h2>
                    
                    <span class="meta">Posted by MrFu on December 13, 2017</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

				<blockquote>
  <p>The notes of <a href="https://store.raywenderlich.com/products/swift-apprentice">Swift Apprentice</a></p>
</blockquote>

<h2 id="code-organization">Code Organization</h2>

<p>A theme of access control is the idea that your code should be loosely coupled and highly cohesive. Loosely coupled code limits how much one entity knows about another, which in turn makes different parts of your code less dependent on others.</p>

<h3 id="extensions-by-protocol-conformance">Extensions by protocol conformance</h3>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">CheckingAccount</span><span class="p">:</span> <span class="kt">CustomStringConvertible</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="k">var</span> <span class="nv">description</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">"Checking Balance: $</span><span class="se">\(</span><span class="n">balance</span><span class="se">)</span><span class="s">"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>Makes it obvious <em>description</em> is part of * CustomStringConvertible*</li>
  <li>Doesn’t help conform to other protocols</li>
  <li>Can easily be removed without doing collateral damage to the rest of * CheckingAccount*</li>
  <li>Is easy to grok!</li>
</ul>

<h3 id="singleton-pattern">Singleton pattern</h3>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">MyManager</span> <span class="p">{</span>
	<span class="kd">static</span> <span class="k">let</span> <span class="nv">shared</span> <span class="o">=</span> <span class="kt">MyManager</span><span class="p">()</span>
	<span class="kd">private</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></div></div>
<h3 id="subscripts">Subscripts</h3>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="nf">subscript</span><span class="p">(</span><span class="n">parameterList</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">ReturnType</span> <span class="p">{</span>
		<span class="k">get</span> <span class="p">{</span>
			<span class="c1">//return someValue of ReturnType</span>
		<span class="p">}</span>
		
		<span class="nf">set</span><span class="p">(</span><span class="n">newValue</span><span class="p">)</span> <span class="p">{</span>
			<span class="c1">// set someValue of ReturnType to newValue</span>
		<span class="p">}</span>
	<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>The subscript’s prototype looks like a function’s signature: It has a parameter list and a return type, but instead of the <code class="highlighter-rouge">func</code> keyword and the function’s name, you use the <code class="highlighter-rouge">subscript</code> keyword.</li>
  <li>It has both a getter and a setter. The setter is optional, so the subscript can be either read-write or read-only.</li>
</ul>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">Person</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
  <span class="k">let</span> <span class="nv">age</span><span class="p">:</span> <span class="kt">Int</span>
  
  <span class="nf">init</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">age</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">me</span> <span class="o">=</span> <span class="kt">Person</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"Cosmin"</span><span class="p">,</span> <span class="nv">age</span><span class="p">:</span> <span class="mi">31</span><span class="p">)</span>

<span class="kd">extension</span> <span class="kt">Person</span> <span class="p">{</span>
  <span class="nf">subscript</span><span class="p">(</span><span class="n">property</span> <span class="nv">key</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">?</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="n">key</span> <span class="p">{</span>
      <span class="k">case</span> <span class="s">"name"</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">name</span>
      <span class="k">case</span> <span class="s">"age"</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">"</span><span class="se">\(</span><span class="n">age</span><span class="se">)</span><span class="s">"</span>
      <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">me</span><span class="p">[</span><span class="nv">property</span><span class="p">:</span> <span class="s">"name"</span><span class="p">]</span>
<span class="n">me</span><span class="p">[</span><span class="nv">property</span><span class="p">:</span> <span class="s">"age"</span><span class="p">]</span>
<span class="n">me</span><span class="p">[</span><span class="nv">property</span><span class="p">:</span> <span class="s">"gender"</span><span class="p">]</span>

<span class="c1">//output</span>
<span class="c1">//Cosmin</span>
<span class="c1">//31</span>
<span class="c1">//nil</span>
</code></pre></div></div>

<h3 id="keypaths">Keypaths</h3>

<p><strong>Keypaths</strong> enable you to store references to properties. For example, this is how you model the tutorials on a website:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">Tutorial</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span>
  <span class="k">let</span> <span class="nv">author</span><span class="p">:</span> <span class="kt">Person</span>
  <span class="k">let</span> <span class="nv">type</span><span class="p">:</span> <span class="kt">String</span>
  <span class="k">let</span> <span class="nv">publishDate</span><span class="p">:</span> <span class="kt">Date</span>
  
  <span class="nf">init</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">author</span><span class="p">:</span> <span class="kt">Person</span><span class="p">,</span> <span class="nv">type</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">publishDate</span><span class="p">:</span> <span class="kt">Date</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
    <span class="k">self</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
    <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">type</span>
    <span class="k">self</span><span class="o">.</span><span class="n">publishDate</span> <span class="o">=</span> <span class="n">publishDate</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">tutorial</span> <span class="o">=</span> <span class="kt">Tutorial</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"Object Oriented Programming in Swift"</span><span class="p">,</span> <span class="nv">author</span><span class="p">:</span> <span class="n">me</span><span class="p">,</span> <span class="nv">type</span><span class="p">:</span> <span class="s">"Swift"</span><span class="p">,</span> <span class="nv">publishDate</span><span class="p">:</span> <span class="kt">Date</span><span class="p">())</span>

<span class="c1">//a *backslash* to create a keypath for the `title` property of the `Tutorial` class and then access its corresponding data with the `keyPath(_:)` subscript.</span>
<span class="k">let</span> <span class="nv">title</span> <span class="o">=</span> <span class="p">\</span><span class="kt">Tutorial</span><span class="o">.</span><span class="n">title</span>
<span class="k">let</span> <span class="nv">tutorialTitle</span> <span class="o">=</span> <span class="n">tutorial</span><span class="p">[</span><span class="nv">keyPath</span><span class="p">:</span> <span class="n">title</span><span class="p">]</span>

<span class="c1">//Keypaths can access properties several levels deep:</span>
<span class="k">let</span> <span class="nv">authorName</span> <span class="o">=</span> <span class="p">\</span><span class="kt">Tutorial</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">name</span>
<span class="k">var</span> <span class="nv">tutorialAuthor</span> <span class="o">=</span> <span class="n">tutorial</span><span class="p">[</span><span class="nv">keyPath</span><span class="p">:</span> <span class="n">authorName</span><span class="p">]</span>

<span class="k">let</span> <span class="nv">authorPath</span> <span class="o">=</span> <span class="p">\</span><span class="kt">Tutorial</span><span class="o">.</span><span class="n">author</span>
<span class="k">let</span> <span class="nv">authorNamePath</span> <span class="o">=</span> <span class="n">authorPath</span><span class="o">.</span><span class="nf">appending</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="n">tutorialAuthor</span> <span class="o">=</span> <span class="n">tutorial</span><span class="p">[</span><span class="nv">keyPath</span><span class="p">:</span> <span class="n">authorNamePath</span><span class="p">]</span>

</code></pre></div></div>

<h4 id="setting-properties">Setting properties</h4>

<p>Using keypaths is more involved than using properties. It becomes a wo-step process:</p>

<ol>
  <li>First, you decide which property you need and create a keypath.</li>
  <li>Then, you pass this keypath to an instance using the keypath subscript to access the selected property.</li>
</ol>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">Jukebox</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">song</span><span class="p">:</span> <span class="kt">String</span>
  
  <span class="nf">init</span><span class="p">(</span><span class="nv">song</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">self</span><span class="o">.</span><span class="n">song</span> <span class="o">=</span> <span class="n">song</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">jukebox</span> <span class="o">=</span> <span class="kt">Jukebox</span><span class="p">(</span><span class="nv">song</span><span class="p">:</span> <span class="s">"Nothing else matters"</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">song</span> <span class="o">=</span> <span class="p">\</span><span class="kt">Jukebox</span><span class="o">.</span><span class="n">song</span>
<span class="n">jukebox</span><span class="p">[</span><span class="nv">keyPath</span><span class="p">:</span> <span class="n">song</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Stairway to heaven"</span>
</code></pre></div></div>

<p>The benefit of this process is that it allows you to parameterize the properties you use in your code. Instead of hard coding them, you can store them in variables as keypaths. You could even leave it up to your users to decide which properties should be used!</p>

<h2 id="pattern-matching">Pattern Matching</h2>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">coordinate</span> <span class="o">=</span> <span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">z</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
<span class="c1">//1</span>
<span class="k">if</span> <span class="p">(</span><span class="n">coordinate</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">coordinate</span><span class="o">.</span><span class="n">z</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"along the x-axis"</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1">//2</span>
<span class="k">if</span> <span class="k">case</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="n">coordinate</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"along the x-axis"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>1 and 2 code snippets will achieve the same result.</p>

<p>The first option digs into the internals of a tuple and has a long equatable comparison.</p>

<p>The second option, using pattern matching, is concise and readable.</p>

<blockquote>
  <p>Patterns provide rules to match values.</p>

  <p>You can also use patterns in <code class="highlighter-rouge">switch</code> cases, as well as in <code class="highlighter-rouge">if</code>, <code class="highlighter-rouge">while</code>, <code class="highlighter-rouge">guard</code> and <code class="highlighter-rouge">for</code> statements. You can also use patterns in variable and constant declarations.</p>
</blockquote>

<h4 id="switch">switch</h4>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">process</span><span class="p">(</span><span class="nv">point</span><span class="p">:</span> <span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="kt">Int</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="kt">Int</span><span class="p">,</span> <span class="nv">z</span><span class="p">:</span> <span class="kt">Int</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">closeRange</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">...</span><span class="mi">2</span>
  <span class="k">let</span> <span class="nv">midRange</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span><span class="o">...</span><span class="mi">5</span>
  <span class="k">switch</span> <span class="n">point</span> <span class="p">{</span>
  <span class="k">case</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">"At origin"</span>
  <span class="k">case</span> <span class="p">(</span><span class="n">closeRange</span><span class="p">,</span> <span class="n">closeRange</span><span class="p">,</span> <span class="n">closeRange</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">"Very close to origin"</span>
  <span class="k">case</span> <span class="p">(</span><span class="n">midRange</span><span class="p">,</span> <span class="n">midRange</span><span class="p">,</span> <span class="n">midRange</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">"Nearby origin"</span>
  <span class="k">default</span><span class="p">:</span>
    <span class="k">return</span> <span class="s">"Not near origin"</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="k">let</span> <span class="nv">point</span> <span class="o">=</span> <span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nv">z</span><span class="p">:</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">response</span> <span class="o">=</span> <span class="nf">process</span><span class="p">(</span><span class="nv">point</span><span class="p">:</span> <span class="n">point</span><span class="p">)</span><span class="c1">// Not near origin</span>
</code></pre></div></div>

<p>This code introduces a couple of new concepts:</p>

<ol>
  <li>You can match against ranges of numbers.</li>
  <li>The <code class="highlighter-rouge">switch</code> statement allows for multiple cases to match patterns.</li>
</ol>

<h4 id="for">for</h4>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">groupSizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="k">for</span> <span class="k">case</span> <span class="mi">1</span> <span class="k">in</span> <span class="n">groupSizes</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"Found an individual"</span><span class="p">)</span><span class="c1">// 2 times</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="patterns">Patterns</h3>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="k">case</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="n">coordinate</span> <span class="p">{</span>
  <span class="c1">// x can be any value. y and z must be exactly 0.</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"On the x-axis"</span><span class="p">)</span> <span class="c1">// On the x-axis</span>
<span class="p">}</span>

<span class="c1">//Value-binding pattern</span>
<span class="k">if</span> <span class="k">case</span> <span class="p">(</span><span class="k">let</span> <span class="nv">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="n">coordinate</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"On the x-axis at </span><span class="se">\(</span><span class="n">x</span><span class="se">)</span><span class="s">"</span><span class="p">)</span> <span class="c1">// On the x-axis at 1</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="enumeration-case-pattern">Enumeration case pattern</h4>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">enum</span> <span class="kt">Organism</span> <span class="p">{</span>
  <span class="k">case</span> <span class="n">plant</span>
  <span class="k">case</span> <span class="nf">animal</span><span class="p">(</span><span class="nv">legs</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">let</span> <span class="nv">pet</span> <span class="o">=</span> <span class="kt">Organism</span><span class="o">.</span><span class="nf">animal</span><span class="p">(</span><span class="nv">legs</span><span class="p">:</span> <span class="mi">4</span><span class="p">)</span>
<span class="k">switch</span> <span class="n">pet</span> <span class="p">{</span>
<span class="k">case</span> <span class="o">.</span><span class="nf">animal</span><span class="p">(</span><span class="k">let</span> <span class="nv">legs</span><span class="p">):</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"Potentially cuddly with </span><span class="se">\(</span><span class="n">legs</span><span class="se">)</span><span class="s"> legs"</span><span class="p">)</span> 
<span class="k">default</span><span class="p">:</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"No chance for cuddles"</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1">// output</span>
<span class="c1">// Potentially cuddly with 4 legs</span>
</code></pre></div></div>

<h4 id="optional-pattern">Optional pattern</h4>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">names</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">?]</span> <span class="o">=</span> <span class="p">[</span><span class="s">"Michelle"</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="s">"Brandon"</span><span class="p">,</span> <span class="s">"Christine"</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="s">"David"</span><span class="p">]</span>

<span class="k">for</span> <span class="k">case</span> <span class="o">.</span><span class="nf">some</span><span class="p">(</span><span class="k">let</span> <span class="nv">name</span><span class="p">)</span> <span class="k">in</span> <span class="n">names</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="c1">// 4 times</span>
<span class="p">}</span>
<span class="c1">//or</span>
<span class="k">for</span> <span class="k">case</span> <span class="k">let</span> <span class="nv">name</span><span class="p">?</span> <span class="k">in</span> <span class="n">names</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="c1">// 4 times</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="is-and-as-type-casting-pattern">“Is” and “As” type-casting pattern</h4>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">array</span><span class="p">:</span> <span class="p">[</span><span class="kt">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="s">"George"</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]</span>
<span class="k">for</span> <span class="n">element</span> <span class="k">in</span> <span class="n">array</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="n">element</span> <span class="p">{</span>
  <span class="k">case</span> <span class="k">is</span> <span class="kt">String</span><span class="p">:</span> <span class="c1">// aha</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Found a string"</span><span class="p">)</span> <span class="c1">// 1 time</span>
  <span class="c1">//This case will never be executed just for example</span>
  <span class="c1">//case let text as String: // 1 time</span>
  <span class="c1">//  print("Found a string: \(text)")</span>
  <span class="k">default</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Found something else"</span><span class="p">)</span> <span class="c1">// 2 times</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="advanced-patterns">Advanced patterns</h3>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">number</span> <span class="k">in</span> <span class="mi">1</span><span class="o">...</span><span class="mi">9</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="n">number</span> <span class="p">{</span>
  <span class="k">case</span> <span class="k">let</span> <span class="nv">x</span> <span class="k">where</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"even"</span><span class="p">)</span> <span class="c1">// 4 times</span>
  <span class="k">default</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"odd"</span><span class="p">)</span> <span class="c1">// 5 time</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">enum</span> <span class="kt">LevelStatus</span> <span class="p">{</span>
  <span class="k">case</span> <span class="n">complete</span>
  <span class="k">case</span> <span class="nf">inProgress</span><span class="p">(</span><span class="nv">percent</span><span class="p">:</span> <span class="kt">Double</span><span class="p">)</span>
  <span class="k">case</span> <span class="n">notStarted</span>
<span class="p">}</span>
<span class="k">let</span> <span class="nv">levels</span><span class="p">:</span> <span class="p">[</span><span class="kt">LevelStatus</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="n">complete</span><span class="p">,</span> <span class="o">.</span><span class="nf">inProgress</span><span class="p">(</span><span class="nv">percent</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">),</span> <span class="o">.</span><span class="n">notStarted</span><span class="p">]</span>
<span class="k">for</span> <span class="n">level</span> <span class="k">in</span> <span class="n">levels</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="n">level</span> <span class="p">{</span>
  <span class="k">case</span> <span class="o">.</span><span class="nf">inProgress</span><span class="p">(</span><span class="k">let</span> <span class="nv">percent</span><span class="p">)</span> <span class="k">where</span> <span class="n">percent</span> <span class="o">&gt;</span> <span class="mf">0.8</span> <span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Almost there!"</span><span class="p">)</span>
  <span class="k">case</span> <span class="o">.</span><span class="nf">inProgress</span><span class="p">(</span><span class="k">let</span> <span class="nv">percent</span><span class="p">)</span> <span class="k">where</span> <span class="n">percent</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Halfway there!"</span><span class="p">)</span>
  <span class="k">case</span> <span class="o">.</span><span class="nf">inProgress</span><span class="p">(</span><span class="k">let</span> <span class="nv">percent</span><span class="p">)</span> <span class="k">where</span> <span class="n">percent</span> <span class="o">&gt;</span> <span class="mf">0.2</span> <span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Made it through the beginning!"</span><span class="p">)</span>
  <span class="k">default</span><span class="p">:</span>
    <span class="k">break</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// Almost there!</span>
</code></pre></div></div>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">timeOfDayDescription</span><span class="p">(</span><span class="nv">hour</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="n">hour</span> <span class="p">{</span>
  <span class="k">case</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span>
    <span class="k">return</span> <span class="s">"Early morning"</span>
  <span class="k">case</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">:</span>
    <span class="k">return</span> <span class="s">"Morning"</span>
  <span class="k">case</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">:</span>
    <span class="k">return</span> <span class="s">"Afternoon"</span>
  <span class="k">case</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">:</span>
    <span class="k">return</span> <span class="s">"Evening"</span>
  <span class="k">case</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">:</span>
    <span class="k">return</span> <span class="s">"Late evening"</span>
  <span class="k">default</span><span class="p">:</span>
    <span class="k">return</span> <span class="s">"INVALID HOUR!"</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="k">let</span> <span class="nv">timeOfDay</span> <span class="o">=</span> <span class="nf">timeOfDayDescription</span><span class="p">(</span><span class="nv">hour</span><span class="p">:</span> <span class="mi">12</span><span class="p">)</span> <span class="c1">// Afternoon</span>
</code></pre></div></div>

<p>Here you see several identifier patterns matched in each case condition. You can use the constants and variables you bind in preceding patterns in the patterns that follow after each comma.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">enum</span> <span class="kt">Organism</span> <span class="p">{</span>
  <span class="k">case</span> <span class="n">plant</span>
  <span class="k">case</span> <span class="nf">animal</span><span class="p">(</span><span class="nv">legs</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">let</span> <span class="nv">pet</span> <span class="o">=</span> <span class="kt">Organism</span><span class="o">.</span><span class="nf">animal</span><span class="p">(</span><span class="nv">legs</span><span class="p">:</span> <span class="mi">4</span><span class="p">)</span>
<span class="k">if</span> <span class="k">case</span> <span class="o">.</span><span class="nf">animal</span><span class="p">(</span><span class="k">let</span> <span class="nv">legs</span><span class="p">)</span> <span class="o">=</span> <span class="n">pet</span><span class="p">,</span> <span class="k">case</span> <span class="mi">2</span><span class="o">...</span><span class="mi">4</span> <span class="o">=</span> <span class="n">legs</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"potentially cuddly"</span><span class="p">)</span> <span class="c1">// Printed!</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"no chance for cuddles"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The first patteran, before the comma, binds the associated value of the enumeration to the constant <em>legs</em>.</p>

<p><code class="highlighter-rouge">if</code> statement is surprisingly capable.</p>

<ul>
  <li><strong>Simple logical test</strong> E.g.: <code class="highlighter-rouge">foo == 10 || bar &gt; baz</code>.</li>
  <li><strong>Optional binding</strong> E.g.: <code class="highlighter-rouge">let foo = maybeFoo</code>.</li>
  <li><strong>Pattern matching</strong> E.g.: <code class="highlighter-rouge">case .bar(let something) = theValue</code>.</li>
</ul>

<h3 id="custom-tuple">Custom tuple</h3>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="s">"Bob"</span>
<span class="k">let</span> <span class="nv">age</span> <span class="o">=</span> <span class="mi">23</span>
<span class="k">if</span> <span class="k">case</span> <span class="p">(</span><span class="s">"Bob"</span><span class="p">,</span> <span class="mi">23</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"Found the right Bob!"</span><span class="p">)</span> <span class="c1">// Printed!</span>
<span class="p">}</span>

<span class="k">var</span> <span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
<span class="k">var</span> <span class="nv">password</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
<span class="k">switch</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span> <span class="p">{</span>
<span class="k">case</span> <span class="k">let</span> <span class="p">(</span><span class="nv">username</span><span class="err">?</span><span class="p">,</span> <span class="nv">password</span><span class="err">?</span><span class="p">):</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"Success! User: </span><span class="se">\(</span><span class="n">username</span><span class="se">)</span><span class="s"> Pass: </span><span class="se">\(</span><span class="n">password</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="k">case</span> <span class="k">let</span> <span class="p">(</span><span class="nv">username</span><span class="err">?</span><span class="p">,</span> <span class="nv">nil</span><span class="p">):</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"Password is missing. User: </span><span class="se">\(</span><span class="n">username</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="k">case</span> <span class="k">let</span> <span class="p">(</span><span class="nv">nil</span><span class="p">,</span> <span class="nv">password</span><span class="err">?</span><span class="p">):</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"Username is missing. Pass: </span><span class="se">\(</span><span class="n">password</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="k">case</span> <span class="p">(</span><span class="kc">nil</span><span class="p">,</span> <span class="kc">nil</span><span class="p">):</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"Both username and password are missing"</span><span class="p">)</span> <span class="c1">// Printed!</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="programming-exercises">Programming exercises</h3>

<h4 id="fibonacci">Fibonacci</h4>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="nv">position</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="n">position</span> <span class="p">{</span>
  <span class="c1">// 1</span>
  <span class="k">case</span> <span class="k">let</span> <span class="nv">n</span> <span class="k">where</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">return</span> <span class="mi">0</span> <span class="c1">// 233 times</span>
  <span class="c1">// 2</span>
  <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="c1">// 377 times</span>
  <span class="c1">// 3</span>
  <span class="k">case</span> <span class="k">let</span> <span class="nv">n</span><span class="p">:</span>
    <span class="k">return</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="nv">position</span><span class="p">:</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="nv">position</span><span class="p">:</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="c1">// 609 times</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="k">let</span> <span class="nv">fib15</span> <span class="o">=</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="nv">position</span><span class="p">:</span> <span class="mi">15</span><span class="p">)</span> <span class="c1">// 377</span>
</code></pre></div></div>

<h3 id="expression-pattern">Expression pattern</h3>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">matched</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">...</span><span class="mi">10</span> <span class="o">~=</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">// ture</span>

<span class="k">if</span> <span class="k">case</span> <span class="mi">1</span><span class="o">...</span><span class="mi">10</span> <span class="o">=</span> <span class="mi">5</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"In the range"</span><span class="p">)</span> <span class="c1">// Printed!</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="overloading-">Overloading ~=</h4>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 1 The function takes an array of integers as its pattern parameter and an integer as its value parameter. The function returns a Bool</span>
<span class="kd">func</span> <span class="o">~=</span><span class="p">(</span><span class="nv">pattern</span><span class="p">:</span> <span class="p">[</span><span class="kt">Int</span><span class="p">],</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
  <span class="c1">//iterates through each element in the array.</span>
  <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">pattern</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">value</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">false</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="k">let</span> <span class="nv">integer</span> <span class="o">=</span> <span class="mi">2</span>

<span class="k">let</span> <span class="nv">isInArray</span> <span class="o">=</span> <span class="p">(</span><span class="n">list</span> <span class="o">~=</span> <span class="n">integer</span><span class="p">)</span> <span class="c1">// true</span>

<span class="k">if</span> <span class="k">case</span> <span class="n">list</span> <span class="o">=</span> <span class="n">integer</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"The integer is in the array"</span><span class="p">)</span> <span class="c1">// Printed!</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"The integer is not in the array"</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Sure, you could check if the integer is in the array like this:</span>
<span class="k">let</span> <span class="nv">isInList</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">integer</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="error-handling">Error Handling</h2>

<h3 id="failable-initializers">Failable initializers</h3>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">enum</span> <span class="kt">PetFood</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span>
  <span class="k">case</span> <span class="n">kibble</span><span class="p">,</span> <span class="n">canned</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">morning</span> <span class="o">=</span> <span class="kt">PetFood</span><span class="p">(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="s">"kibble"</span><span class="p">)</span> <span class="c1">// Optional(3)</span>
<span class="k">let</span> <span class="nv">snack</span> <span class="o">=</span> <span class="kt">PetFood</span><span class="p">(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="s">"fuuud!"</span><span class="p">)</span> <span class="c1">// nil</span>
</code></pre></div></div>

<p>As you can see, failable initializers return optionals instead of regular instances. The return value will be <code class="highlighter-rouge">nil</code> if initialization failed.</p>

<p>You can create failable initializers yourself:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">PetHouse</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">squareFeet</span><span class="p">:</span> <span class="kt">Int</span>
  <span class="c1">// Simply name it init?(...) and return nil if it fails</span>
  <span class="nf">init</span><span class="p">?(</span><span class="nv">squareFeet</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">squareFeet</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
    <span class="k">self</span><span class="o">.</span><span class="n">squareFeet</span> <span class="o">=</span> <span class="n">squareFeet</span>
  <span class="p">}</span>
<span class="p">}</span>
 
<span class="k">let</span> <span class="nv">tooSmall</span> <span class="o">=</span> <span class="kt">PetHouse</span><span class="p">(</span><span class="nv">squareFeet</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">// nil</span>
<span class="k">let</span> <span class="nv">house</span> <span class="o">=</span> <span class="kt">PetHouse</span><span class="p">(</span><span class="nv">squareFeet</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">// Optional(PetHouse)</span>
</code></pre></div></div>

<p>By using a failable initializer, you can <code class="highlighter-rouge">guarantee</code> that your instance has the correct attributes or it will never exist.</p>

<h3 id="optional-chaining">Optional chaining</h3>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="k">let</span> <span class="nv">dogBreed</span> <span class="o">=</span> <span class="n">janie</span><span class="o">.</span><span class="n">pet</span><span class="o">.</span><span class="n">breed</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"Olive is a </span><span class="se">\(</span><span class="n">dogBreed</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"Olive's breed is unknown."</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="example">Example</h4>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">Toy</span> <span class="p">{</span>
    
  <span class="kd">enum</span> <span class="kt">Kind</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">ball</span>
    <span class="k">case</span> <span class="n">zombie</span>
    <span class="k">case</span> <span class="n">bone</span>
    <span class="k">case</span> <span class="n">mouse</span>
  <span class="p">}</span>
    
  <span class="kd">enum</span> <span class="kt">Sound</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">squeak</span>
    <span class="k">case</span> <span class="n">bell</span>
  <span class="p">}</span>
    
  <span class="k">let</span> <span class="nv">kind</span><span class="p">:</span> <span class="kt">Kind</span>
  <span class="k">let</span> <span class="nv">color</span><span class="p">:</span> <span class="kt">String</span>
  <span class="k">var</span> <span class="nv">sound</span><span class="p">:</span> <span class="kt">Sound</span><span class="p">?</span>
    
  <span class="nf">init</span><span class="p">(</span><span class="nv">kind</span><span class="p">:</span> <span class="kt">Kind</span><span class="p">,</span> <span class="nv">color</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">sound</span><span class="p">:</span> <span class="kt">Sound</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">self</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span>
    <span class="k">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
    <span class="k">self</span><span class="o">.</span><span class="n">sound</span> <span class="o">=</span> <span class="n">sound</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">Pet</span> <span class="p">{</span>
    
  <span class="kd">enum</span> <span class="kt">Kind</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">dog</span>
    <span class="k">case</span> <span class="n">cat</span>
    <span class="k">case</span> <span class="n">guineaPig</span>
  <span class="p">}</span>
    
  <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
  <span class="k">let</span> <span class="nv">kind</span><span class="p">:</span> <span class="kt">Kind</span>
  <span class="k">let</span> <span class="nv">favoriteToy</span><span class="p">:</span> <span class="kt">Toy</span><span class="p">?</span>
    
  <span class="nf">init</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">kind</span><span class="p">:</span> <span class="kt">Kind</span><span class="p">,</span> <span class="nv">favoriteToy</span><span class="p">:</span> <span class="kt">Toy</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">self</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span>
    <span class="k">self</span><span class="o">.</span><span class="n">favoriteToy</span> <span class="o">=</span> <span class="n">favoriteToy</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">Person</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">pet</span><span class="p">:</span> <span class="kt">Pet</span><span class="p">?</span>
    
  <span class="nf">init</span><span class="p">(</span><span class="nv">pet</span><span class="p">:</span> <span class="kt">Pet</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">self</span><span class="o">.</span><span class="n">pet</span> <span class="o">=</span> <span class="n">pet</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">janie</span> <span class="o">=</span> <span class="kt">Person</span><span class="p">(</span><span class="nv">pet</span><span class="p">:</span> <span class="kt">Pet</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"Delia"</span><span class="p">,</span> <span class="nv">kind</span><span class="p">:</span> <span class="o">.</span><span class="n">dog</span><span class="p">,</span> <span class="nv">favoriteToy</span><span class="p">:</span> <span class="kt">Toy</span><span class="p">(</span><span class="nv">kind</span><span class="p">:</span> <span class="o">.</span><span class="n">ball</span><span class="p">,</span> <span class="nv">color</span><span class="p">:</span> <span class="s">"Purple"</span><span class="p">,</span> <span class="nv">sound</span><span class="p">:</span> <span class="o">.</span><span class="n">bell</span><span class="p">)))</span>
<span class="k">let</span> <span class="nv">tammy</span> <span class="o">=</span> <span class="kt">Person</span><span class="p">(</span><span class="nv">pet</span><span class="p">:</span> <span class="kt">Pet</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"Evil Cat Overlord"</span><span class="p">,</span> <span class="nv">kind</span><span class="p">:</span> <span class="o">.</span><span class="n">cat</span><span class="p">,</span> <span class="nv">favoriteToy</span><span class="p">:</span> <span class="kt">Toy</span><span class="p">(</span><span class="nv">kind</span><span class="p">:</span> <span class="o">.</span><span class="n">mouse</span><span class="p">,</span> <span class="nv">color</span><span class="p">:</span> <span class="s">"Orange"</span><span class="p">)))</span>
<span class="k">let</span> <span class="nv">felipe</span> <span class="o">=</span> <span class="kt">Person</span><span class="p">()</span>
</code></pre></div></div>

<p>Now you want to check to see if any of the team members has a pet with a favorite toy that makes a sound.</p>

<h5 id="using-optional-chaining">Using <strong>optional chaining</strong>:</h5>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="k">let</span> <span class="nv">sound</span> <span class="o">=</span> <span class="n">janie</span><span class="o">.</span><span class="n">pet</span><span class="p">?</span><span class="o">.</span><span class="n">favoriteToy</span><span class="p">?</span><span class="o">.</span><span class="n">sound</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"Sound </span><span class="se">\(</span><span class="n">sound</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"No sound."</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">if</span> <span class="k">let</span> <span class="nv">sound</span> <span class="o">=</span> <span class="n">tammy</span><span class="o">.</span><span class="n">pet</span><span class="p">?</span><span class="o">.</span><span class="n">favoriteToy</span><span class="p">?</span><span class="o">.</span><span class="n">sound</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"Sound </span><span class="se">\(</span><span class="n">sound</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"No sound."</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">if</span> <span class="k">let</span> <span class="nv">sound</span> <span class="o">=</span> <span class="n">felipe</span><span class="o">.</span><span class="n">pet</span><span class="p">?</span><span class="o">.</span><span class="n">favoriteToy</span><span class="p">?</span><span class="o">.</span><span class="n">sound</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"Sound </span><span class="se">\(</span><span class="n">sound</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"No sound."</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This is an awful lot of repetitive code.</p>

<h5 id="map-and-flatmap">Map and flatMap</h5>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">team</span> <span class="o">=</span> <span class="p">[</span><span class="n">janie</span><span class="p">,</span> <span class="n">tammy</span><span class="p">,</span> <span class="n">felipe</span><span class="p">]</span>
<span class="k">let</span> <span class="nv">petNames</span> <span class="o">=</span> <span class="n">team</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">pet</span><span class="p">?</span><span class="o">.</span><span class="n">name</span> <span class="p">}</span>

<span class="k">for</span> <span class="n">pet</span> <span class="k">in</span> <span class="n">petNames</span> <span class="p">{</span>
  <span class="c1">// compiler warns you about conversion from Optional to Any</span>
  <span class="c1">// print(pet)</span>
  <span class="nf">print</span><span class="p">(</span><span class="n">pet</span> <span class="k">as</span> <span class="kt">Any</span><span class="p">)</span> <span class="c1">// cast to Any to shut the warning off</span>
  <span class="c1">//output</span>
  <span class="c1">//Optional("Delia")</span>
  <span class="c1">//Optional("Evil Cat Overlord")</span>
  <span class="c1">//nil</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">betterPetNames</span> <span class="o">=</span> <span class="n">team</span><span class="o">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">pet</span><span class="p">?</span><span class="o">.</span><span class="n">name</span> <span class="p">}</span>

<span class="k">for</span> <span class="n">pet</span> <span class="k">in</span> <span class="n">betterPetNames</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="n">pet</span><span class="p">)</span>
  <span class="c1">//output</span>
  <span class="c1">//Delia</span>
  <span class="c1">//Evil Cat Overlord</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In this case, you’re using <code class="highlighter-rouge">flatMap</code> to flatten the return type <code class="highlighter-rouge">[Optional&lt;String&gt;]</code> into the simpler type <code class="highlighter-rouge">[String]</code>. Another common use of `flatMap is to turn an array of arrays into a single array.</p>

<h3 id="error-protocol">Error protocol</h3>

<p>The <code class="highlighter-rouge">Error</code> protocol (showed on below) tells the compiler that this enumeration can be used to represent errors that can be thrown.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">Pastry</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">flavor</span><span class="p">:</span> <span class="kt">String</span>
  <span class="k">var</span> <span class="nv">numberOnHand</span><span class="p">:</span> <span class="kt">Int</span>
    
  <span class="nf">init</span><span class="p">(</span><span class="nv">flavor</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">numberOnHand</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">self</span><span class="o">.</span><span class="n">flavor</span> <span class="o">=</span> <span class="n">flavor</span>
    <span class="k">self</span><span class="o">.</span><span class="n">numberOnHand</span> <span class="o">=</span> <span class="n">numberOnHand</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">enum</span> <span class="kt">BakeryError</span><span class="p">:</span> <span class="kt">Error</span> <span class="p">{</span>
  <span class="k">case</span> <span class="nf">tooFew</span><span class="p">(</span><span class="nv">numberOnHand</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span>
  <span class="k">case</span> <span class="n">doNotSell</span>
  <span class="k">case</span> <span class="n">wrongFlavor</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">Bakery</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">itemsForSale</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"Cookie"</span><span class="p">:</span> <span class="kt">Pastry</span><span class="p">(</span><span class="nv">flavor</span><span class="p">:</span> <span class="s">"ChocolateChip"</span><span class="p">,</span> <span class="nv">numberOnHand</span><span class="p">:</span> <span class="mi">20</span><span class="p">),</span>
    <span class="s">"PopTart"</span><span class="p">:</span> <span class="kt">Pastry</span><span class="p">(</span><span class="nv">flavor</span><span class="p">:</span> <span class="s">"WildBerry"</span><span class="p">,</span> <span class="nv">numberOnHand</span><span class="p">:</span> <span class="mi">13</span><span class="p">),</span>
    <span class="s">"Donut"</span> <span class="p">:</span> <span class="kt">Pastry</span><span class="p">(</span><span class="nv">flavor</span><span class="p">:</span> <span class="s">"Sprinkles"</span><span class="p">,</span> <span class="nv">numberOnHand</span><span class="p">:</span> <span class="mi">24</span><span class="p">),</span>
    <span class="s">"HandPie"</span><span class="p">:</span> <span class="kt">Pastry</span><span class="p">(</span><span class="nv">flavor</span><span class="p">:</span> <span class="s">"Cherry"</span><span class="p">,</span> <span class="nv">numberOnHand</span><span class="p">:</span> <span class="mi">6</span><span class="p">)</span>
  <span class="p">]</span>
    
  <span class="kd">func</span> <span class="nf">orderPastry</span><span class="p">(</span><span class="nv">item</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span>
                 <span class="nv">amountRequested</span><span class="p">:</span> <span class="kt">Int</span><span class="p">,</span>
                 <span class="nv">flavor</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span>  <span class="k">throws</span>  <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="p">{</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">pastry</span> <span class="o">=</span> <span class="n">itemsForSale</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="kt">BakeryError</span><span class="o">.</span><span class="n">doNotSell</span>
    <span class="p">}</span>
    <span class="k">guard</span> <span class="n">flavor</span> <span class="o">==</span> <span class="n">pastry</span><span class="o">.</span><span class="n">flavor</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="kt">BakeryError</span><span class="o">.</span><span class="n">wrongFlavor</span>
    <span class="p">}</span>
    <span class="k">guard</span> <span class="n">amountRequested</span> <span class="o">&lt;=</span> <span class="n">pastry</span><span class="o">.</span><span class="n">numberOnHand</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="kt">BakeryError</span><span class="o">.</span><span class="nf">tooFew</span><span class="p">(</span><span class="nv">numberOnHand</span><span class="p">:</span> <span class="n">pastry</span><span class="o">.</span><span class="n">numberOnHand</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">pastry</span><span class="o">.</span><span class="n">numberOnHand</span> <span class="o">-=</span> <span class="n">amountRequested</span>
        
    <span class="k">return</span> <span class="n">pastry</span><span class="o">.</span><span class="n">numberOnHand</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="handling-errors">Handling errors</h4>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">bakery</span> <span class="o">=</span> <span class="kt">Bakery</span><span class="p">()</span>
<span class="k">do</span> <span class="p">{</span>
    <span class="k">try</span> <span class="n">bakery</span><span class="o">.</span><span class="nf">orderPastry</span><span class="p">(</span><span class="nv">item</span><span class="p">:</span> <span class="s">"Albatross"</span><span class="p">,</span>
                           <span class="nv">amountRequested</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                           <span class="nv">flavor</span><span class="p">:</span> <span class="s">"AlbatrossFlavor"</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="kt">BakeryError</span><span class="o">.</span><span class="n">doNotSell</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"Sorry, but we don't sell this item"</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="kt">BakeryError</span><span class="o">.</span><span class="n">wrongFlavor</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"Sorry, but we don't carry this flavor"</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="kt">BakeryError</span><span class="o">.</span><span class="n">tooFew</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"Sorry, we don't have enough items to fulfill your order"</span><span class="p">)</span>
<span class="p">}</span>

</code></pre></div></div>

<h5 id="not-looking-at-the-detailed-error">Not looking at the detailed error</h5>

<p>If you don’t really care about the details of the rror you can use <code class="highlighter-rouge">try?</code> to wrap the result of a function in an optional.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">remaining</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">bakery</span><span class="o">.</span><span class="nf">orderPastry</span><span class="p">(</span><span class="nv">item</span><span class="p">:</span> <span class="s">"Albatross"</span><span class="p">,</span>
                                        <span class="nv">amountRequested</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                        <span class="nv">flavor</span><span class="p">:</span> <span class="s">"AlbatrossFlavor"</span><span class="p">)</span>
</code></pre></div></div>

<h5 id="stoping-your-program-on-an-error">Stoping your program on an error</h5>

<p>Sometimes you know for sure that your code is not going to fail:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">do</span> <span class="p">{</span>
  <span class="k">try</span> <span class="n">bakery</span><span class="o">.</span><span class="nf">orderPastry</span><span class="p">(</span><span class="nv">item</span><span class="p">:</span> <span class="s">"Cookie"</span><span class="p">,</span> <span class="nv">amountRequested</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">flavor</span><span class="p">:</span> <span class="s">"ChocolateChip"</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">{</span>
  <span class="nf">fatalError</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<p>And there is a short way to write the same thing:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try!</span> <span class="n">bakery</span><span class="o">.</span><span class="nf">orderPastry</span><span class="p">(</span><span class="nv">item</span><span class="p">:</span> <span class="s">"Cookie"</span><span class="p">,</span> <span class="nv">amountRequested</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">flavor</span><span class="p">:</span> <span class="s">"ChocolateChip"</span><span class="p">)</span>
</code></pre></div></div>

<p>It’s delicious syntactic sugar. Be extra careful when using <code class="highlighter-rouge">try!</code>.</p>

<h4 id="rethrows">Rethrows</h4>

<p>A function that takes a throwing closure as a parameter has to make a choice: either catch every error, or be a throwing funciton itself.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">perform</span><span class="p">(</span><span class="nv">times</span><span class="p">:</span> <span class="kt">Int</span><span class="p">,</span> <span class="nv">movement</span><span class="p">:</span> <span class="p">()</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="p">())</span> <span class="k">rethrows</span> <span class="p">{</span>
  <span class="k">for</span> <span class="n">_</span> <span class="k">in</span> <span class="mi">1</span><span class="o">...</span><span class="n">times</span> <span class="p">{</span>
    <span class="k">try</span> <span class="nf">movement</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Notice the <code class="highlighter-rouge">rethrows</code> here. This function does not handle errors like <code class="highlighter-rouge">moveSafely</code>, but instead leaves the error handling up to the caller of the function, like <em>goHome</em>. By using <code class="highlighter-rouge">rethrows</code> instead of <code class="highlighter-rouge">throws</code>, this function indicates that it will only rethrow errors thrown by the function passed into it, but never errors of its own.</p>

<h2 id="asynchronous-closures-and-memory-management">Asynchronous Closures and Memory Management</h2>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">do</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">author</span> <span class="o">=</span> <span class="kt">Author</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"Cosmin"</span><span class="p">)</span>
  <span class="k">let</span> <span class="nv">tutorial</span><span class="p">:</span> <span class="kt">Tutorial</span> <span class="o">=</span> <span class="kt">Tutorial</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"Memory management"</span><span class="p">,</span> <span class="nv">author</span><span class="p">:</span> <span class="n">author</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>These are placed in a scope (created with <code class="highlighter-rouge">do{}</code>) so that as soon as they go out of scope they are deallocated.</p>

<h3 id="weak-references">Weak references</h3>

<p><strong>Weak references</strong> don’t play any part in the <strong>reference count</strong> of a certain object. You declare them as optionals, so they become <code class="highlighter-rouge">nil</code> once the reference count reaches zero.</p>

<h3 id="unowned-references">Unowned references</h3>

<p><strong>Unowned references</strong> behave much like weak ones: they don’t increase the object’s reference count.</p>

<p>It always expect to have a value - you can’t declare them as optionals.</p>

<h3 id="handling-asynchronous-closures">Handling asynchronous closures</h3>

<p>In <strong>multi-threaded</strong>, work can happen simultaneously on multiple <strong>threads of execution</strong>. For example, all networking operations execute in a background thread so they don’t block the user interface that happends on the main thread.</p>

<p>In practice, working in multi-threaded environments can be very tricky. For example, just as one thread is writing some data, another therad might be trying to read it and get a half-baked value but only very occasionally making it very difficult to diagnose.</p>

<p>That’s why <strong>synchronization</strong> becomes necessary. You can use a framework called <strong>Grand Central Dispatch (GCD)</strong> to simplify many of these issues in Swift.</p>

<p>To run tasks on a background queue, you first need to create a queue:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">queue</span> <span class="o">=</span> <span class="kt">DispatchQueue</span><span class="p">(</span><span class="nv">label</span><span class="p">:</span> <span class="s">"queue"</span><span class="p">)</span>
</code></pre></div></div>

<p>Next, create a method like so:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//1</span>
<span class="kd">func</span> <span class="n">execute</span><span class="o">&lt;</span><span class="kt">Result</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">backgroundWork</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Result</span><span class="p">,</span> <span class="nv">mainWork</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Result</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">())</span> <span class="p">{</span>
  <span class="c1">//2</span>
  <span class="n">queue</span><span class="o">.</span><span class="n">async</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">result</span> <span class="o">=</span> <span class="nf">backgroundWork</span><span class="p">()</span>
    <span class="c1">//3</span>
    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">async</span> <span class="p">{</span>
      <span class="nf">mainWork</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<ol>
  <li>
    <p>You make the function generic because the <code class="highlighter-rouge">backgroundWork</code> closure returns a generic result while the <code class="highlighter-rouge">mainWork</code> closure works with that result. You mark both closures with the <code class="highlighter-rouge">@escaping</code> attribute because they <strong>escape</strong> the function: you use them asynchronously, so they get called after the function returns.</p>
  </li>
  <li>
    <p>You run the <code class="highlighter-rouge">backgroundWork</code> closure asynchronously on the serial queue previously defined and store its return value.</p>
  </li>
  <li>
    <p>You dispatch the <code class="highlighter-rouge">mainWork</code> closure asynchronously on the main queue and you use the <code class="highlighter-rouge">backgroundWork</code> closure’s result as its argument.</p>
  </li>
</ol>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">execute</span><span class="p">(</span><span class="nv">backgroundWork</span><span class="p">:</span> <span class="p">{</span> <span class="nf">addNumbers</span><span class="p">(</span><span class="nv">upTo</span><span class="p">:</span> <span class="mi">100</span><span class="p">)</span> <span class="p">},</span>
        <span class="nv">mainWork</span><span class="p">:</span>  <span class="p">{</span> <span class="nf">log</span><span class="p">(</span><span class="nv">message</span><span class="p">:</span> <span class="s">"The sum is </span><span class="se">\(</span><span class="nv">$0</span><span class="se">)</span><span class="s">"</span><span class="p">)</span> <span class="p">})</span>
<span class="c1">//Background thread: Adding numbers...</span>
<span class="c1">//Main thread: The sum is 5050</span>
</code></pre></div></div>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">editTutorial</span><span class="p">(</span><span class="n">_</span> <span class="nv">tutorial</span><span class="p">:</span> <span class="kt">Tutorial</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">queue</span><span class="o">.</span><span class="nf">async</span><span class="p">()</span> <span class="p">{</span>
	  <span class="p">[</span><span class="k">weak</span> <span class="k">self</span><span class="p">]</span> <span class="k">in</span>
	  
	  <span class="k">guard</span> <span class="k">let</span> <span class="nv">strongSelf</span> <span class="o">=</span> <span class="k">self</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="nf">print</span><span class="p">(</span><span class="s">"I no longer exist so no feedback for you!"</span><span class="p">)</span>
	    <span class="k">return</span>
	  <span class="p">}</span>
	  <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">async</span> <span class="p">{</span>
	    <span class="nf">print</span><span class="p">(</span><span class="n">strongSelf</span><span class="o">.</span><span class="nf">feedback</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">tutorial</span><span class="p">))</span>
	  <span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This code is all or nothing. If the editor has gone away by the time the closure runs, it will print a snarky message. If <code class="highlighter-rouge">strongSelf</code> is not <code class="highlighter-rouge">nil</code> it will stick around until the print statement finishes.</p>

<h2 id="value-types-and-value-semantics">Value Types and Value Semantics</h2>

<blockquote>
  <p>Two kinds of types in Swift: value types and reference types. Structs and enums are value types; classes and functions are reference types.</p>
</blockquote>

<p>These types differ in their behavior. The behavior you’ve come to expect from value types is the result of <strong>Value semantics</strong>.</p>

<p>Reference types use <strong>assign-by-reference</strong>.</p>

<p>Value types use <strong>assign-by-copy</strong>.</p>

<h3 id="when-to-prefer-value-semantics">When to prefer value semantics</h3>

<p>Value semantics are good for representing inert, descriptive data. For example: numbers; strings; physical quantities like angle, length, and color; mathematical objects like vectors and matrices; pure binary data; collections of such values; and finally, large rich structures made from such values, like media.</p>

<p>Reference semantics are good for representing distinct items in your program or in the world. For example: constructs within your program such as specific buttons or memory buffers; an object which plays a specific role in coordinating certain other objects; or a particular person or physical object in the real world.</p>

<h2 id="protocol-oriented-programming">Protocol-Oriented Programming</h2>

<h3 id="type-constraints">Type Constraints</h3>

<p>By using a <strong>type constraints</strong> on a protocol extension, you’re able to use methods and properties from another type inside the implementation of your extension.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protocol</span> <span class="kt">PostSeasonEligible</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">minimumWinsForPlayoffs</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">TeamRecord</span> <span class="k">where</span> <span class="k">Self</span><span class="p">:</span> <span class="kt">PostSeasonEligible</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">isPlayoffEligible</span><span class="p">:</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">wins</span> <span class="o">&gt;</span> <span class="n">minimumWinsForPlayoffs</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">Tieable</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">ties</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">TeamRecord</span> <span class="k">where</span> <span class="k">Self</span><span class="p">:</span> <span class="kt">Tieable</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">winningPercentage</span><span class="p">:</span> <span class="kt">Double</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kt">Double</span><span class="p">(</span><span class="n">wins</span><span class="p">)</span> <span class="o">/</span> <span class="kt">Double</span><span class="p">(</span><span class="n">wins</span> <span class="o">+</span> <span class="n">losses</span> <span class="o">+</span> <span class="n">ties</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">RugyRecord</span><span class="p">:</span> <span class="kt">TeamRecord</span><span class="p">,</span> <span class="kt">Tieable</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">wins</span><span class="p">:</span> <span class="kt">Int</span>
  <span class="k">var</span> <span class="nv">losses</span><span class="p">:</span> <span class="kt">Int</span>
  <span class="k">var</span> <span class="nv">ties</span><span class="p">:</span> <span class="kt">Int</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">rugbyRecord</span> <span class="o">=</span> <span class="kt">RugyRecord</span><span class="p">(</span><span class="nv">wins</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="nv">losses</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="nv">ties</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">rugbyRecord</span><span class="o">.</span><span class="n">winningPercentage</span> <span class="c1">// 0.5</span>
</code></pre></div></div>

<p>You can see that with a combination of protocol extensions and <code class="highlighter-rouge">constrained</code> protocol extensions, you can provide default implementations that make sense for very specific cases.</p>

<h3 id="protocol-oriented-benefits">Protocol-oriented benefits</h3>

<h4 id="programming-to-interfaces-not-implementations">Programming to interfaces, not implementations</h4>

<p>By focusing on protocols instead of implementations, you can apply code contracts to any type - even those that don’t support inheritance.</p>

<h4 id="traits-mixins-and-multiple-inheritance">Traits, mixins, and multiple inheritance</h4>

<p>Speaking of supporting one-off features such as a divisional win or loss, one of the real benefits of protocols is that they allow a form of multiple inheritance.</p>

<p>When creating a type, you can use protocols to decorate it with all the unique characteristics you want:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protocol</span> <span class="kt">TieableRecord</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">ties</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">DivisionalRecord</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">divisionalWins</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
  <span class="k">var</span> <span class="nv">divisionalLosses</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">ScoreableRecord</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">totalPoints</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">ScoreableRecord</span> <span class="k">where</span> <span class="k">Self</span><span class="p">:</span> <span class="kt">TieableRecord</span><span class="p">,</span> <span class="k">Self</span><span class="p">:</span> <span class="kt">TeamRecord</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">totalPoints</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span>
    <span class="nf">return</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">wins</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">ties</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">NewHockeyRecord</span><span class="p">:</span> <span class="kt">TeamRecord</span><span class="p">,</span> <span class="kt">TieableRecord</span><span class="p">,</span> <span class="kt">DivisionalRecord</span><span class="p">,</span> <span class="kt">CustomStringConvertible</span><span class="p">,</span> <span class="kt">Equatable</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">wins</span><span class="p">:</span> <span class="kt">Int</span>
  <span class="k">var</span> <span class="nv">losses</span><span class="p">:</span> <span class="kt">Int</span>
  <span class="k">var</span> <span class="nv">ties</span><span class="p">:</span> <span class="kt">Int</span>
  <span class="k">var</span> <span class="nv">divisionalWins</span><span class="p">:</span> <span class="kt">Int</span>
  <span class="k">var</span> <span class="nv">divisionalLosses</span><span class="p">:</span> <span class="kt">Int</span>
    
  <span class="k">var</span> <span class="nv">description</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">"</span><span class="se">\(</span><span class="n">wins</span><span class="se">)</span><span class="s"> - </span><span class="se">\(</span><span class="n">losses</span><span class="se">)</span><span class="s"> - </span><span class="se">\(</span><span class="n">ties</span><span class="se">)</span><span class="s">"</span>
  <span class="p">}</span>
    
  <span class="kd">static</span> <span class="kd">func</span> <span class="o">==</span><span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">NewHockeyRecord</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">NewHockeyRecord</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">wins</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">wins</span> <span class="o">&amp;&amp;</span>
           <span class="n">lhs</span><span class="o">.</span><span class="n">ties</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">ties</span> <span class="o">&amp;&amp;</span>
           <span class="n">lhs</span><span class="o">.</span><span class="n">losses</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">losses</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Using protocols in this way is described as using <strong>traits</strong> or <strong>mixins</strong>. These terms reflect that you can use protocols and protocol extensions to add, or mix in, additional behaviors, or traits, to a type.</p>

<h4 id="simplicity">Simplicity</h4>

<p>When you write a computed property to calculate the winning percentage, you only need wins, losses and ties. When you write code to print the full name of a person, you only need a first and a last name.</p>

<h3 id="why-swift-is-a-protocol-oriented-language">Why Swift is a protocol-oriented language</h3>

<p>Protocol extensions greatly affect your ability to write expressive and decoupled code - and many of the design patterns that protocol extensions enable are reflected in the Swift language itself.</p>

<p>With a design centered around protocols rather than specific classes, structs or enums, your code is instantly more portable and decoupled, because methods now apply to a range of types instead of one specific type. Your code is also more cohesive, because it operates only on the properties and methods within the protocol you’re extending and its type constraints, and ignores the internal details of any type that conforms to it.</p>

<p>Understanding protocol-oriented programming is a powerful skill that will help you become a better Swift developer, and give you new ways to think about how to design your code.</p>


                <hr>


                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2017/12/01/Swift_Apprentice_I.html" data-toggle="tooltip" data-placement="top" title="Swift Apprentice I -- Basic Topics">
                        Previous<br>
                        <span>Swift Apprentice I -- Basic Topics</span>
                        </a>
                    </li>
                    
                    
                </ul>

                

            </div>

    <!-- Side Catalog Container -->
        
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
        

    <!-- Sidebar Container -->
            <!-- <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                

                
            </div> -->
        </div>
    </div>
</article>






    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/jekyll">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    
                   
                    

                    
                    
                    <!-- delete twitter -->
                    <!--
                    
                    <li>
                        <a href="https://twitter.com/jekyllrb">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    -->
                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; <a href="https://github.com/MrFuFuFu/mrfufufu.github.io">Your awesome title</a> 2019
                    <br>
                    Theme by <a href="http://huangxuan.me">Hux</a><!--  |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=huxpro&repo=huxpro.github.io&type=star&count=true" >
                    </iframe> -->
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js "></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async('/js/jquery.tagcloud.js',function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>







<!-- Side Catalog -->

<script type="text/javascript">
    function generateCatalog (selector) {
        var P = $('div.post-container'),a,n,t,l,i,c;
        a = P.find('h1,h2,h3,h4,h5,h6');
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#"+$(this).prop('id');
            t = $(this).text();
            c = $('<a href="'+i+'" rel="nofollow">'+t+'</a>');
            l = $('<li class="'+n+'_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;    
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function(e){
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/js/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>




<!-- Image to hack wechat -->
<!-- <img src="/img/icon_wechat.png" width="0" height="0" /> -->
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
